app.controller("newCtrl", function($scope, $ionicHistory, $ionicPlatform, $cordovaCamera, $cordovaFileTransfer, PickaloApiService) {
  $scope.images = [];
  $scope.form = {};

  $scope.goBack = function() {
    $ionicHistory.goBack();
  };

  $scope.openCamera = function() {
    $ionicPlatform.ready(function() {
      var options = {
        quality: 50,
        destinationType: Camera.DestinationType.DATA_URL,
        allowEdit: true,
        encodingType: Camera.EncodingType.JPEG,
        targetWidth: 300,
        targetHeight: 300,
        popoverOptions: CameraPopoverOptions,
        saveToPhotoAlbum: false
      };

      $cordovaCamera.getPicture(options).then(function(imageURI) {
        $scope.images.push({
          // imgUrl: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAEsASwDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwCEdKUCkApwFeUeqGKAKWlFIVxoFIRTqSmNDCKYRUtNIpFIjxSEU7FIaBjDxTCKeRTcUDG03FPIptADcUYpaSgYmKTFOpKBiYoxS4ooAMUm2lFLimhWK8qVUkTrV9xVeRa0iyGiltwafHkGn7eaNta3MXE6zQ5ke2AzyKXV41aMMCNwrE0m6MMgXsTXSX1ustnuQc461q/eg0c1uSomc5SEcU4jBxTa4D0xhFVbtN0Zq2aikXKkVcXZktXVjCkXmmLVmdMMarDhq9CLujyakbMenBqzD1xVcCrEXY0EFlBU6nioR92l8wDipsB0KingUgFOArzj1AAo70oFLjvQAzvSU7FJimMbimkVIRTMUhojNNIp56000FIYRSEU6kNAxlNIpxpKBjMUYp1JQMbijFOpKAExRilooASlooxQA1hULrwasEVEwqkyWVNuDRipCvNNIrVMhoITtcH0NdpZP51gO/FcYvWus0Ft1lt9K1pPWxy4he7cxblNlxIvvUBq9qq7bxveqRrlmrSaOym7xTGGmkU+mkUkWZl4mHJ9aoOMGte9TKZ9Ky5FrtpSujgxENQTkVNF0qCDrip04bFbHGWo+VxULD5jUkZ+bPrT2TJyKRJ04FKBQKcK8w9YTFGO1PA4oxTER4pMU/HNB4osMjxSMKfimGkNEbCmGpGFMoLQw000/FNoGMIpKcabQMSkpTSUDEooooAKKKKACiiigAqNhUhpuKaEQMtRHrVlxVdutWiWgXrXVeGh/oxrlB1rr/Da/wCiZrel8RzYj4DO1wYvPwrNrS10/wCnEe1Ztc9T4mb0fgQ2kpxptQakUy7oyKyZVwTWyRwazLlMOa6KL6GNaN0Ugdr5qwecEVBItSQtlcV2I8uSsywhyKnRvlqrGccelSgkdKCTrBT1FIBThXmHqC0YoFLSASmkU/n0ppFMZGRTSKkIppFIaIyKYakYVGaZSGGmmnGmmkUMNIacaaRSKG0o6UYpB1pgJSU4ikxQAlFLRQMSilooAbSgUlOA4piI3FVj96rL/dNV1GTVRJYmOa7Lw6uLEH2rjiOa7XQ122C/SuijuzkxPwmHrZzft9Kz6uawf9PeqfauefxM6aXwIcwBGRUWMU8dKQioNBhqleJ3q7UNyu5DWkHZkyV0ZLjrUcR2SVO4qu4wc12xZ51WPUsHj5qlVuKhibcmKUEgYqzmO4C8U4ClQ4608DPSvMPTGYo21JtowMUguRYNNIqUimGmMjxTD1qQ0wigpDTUTCpGphpFIiIppp5ppFBSGUlOxTcUFCUlLikoAOopKUcGkI5oASiiloGJSGnU2gAFLSAUppgRynC1FGOCadOe1LGPkprREvcYRzXbaQNtgv0rjFXLge9dvYrssB9K6aHU4sVskcrqxzfyVUFT6i2b6U+9QCueW7Oun8KFFJSikqDQaRTHGRTzSEU0IyZlwxFQMueKu3aYbOKq4x2rup6o8+u+XQaiheBThQBSng1qcR6G1uOqGmbCvUVn2+oshw2R9a0YruOUc4rjcE9jsVRrSQitjrUgCkelL5anlaYRt6isnFrc2Uk9hGjwM1Eak3kUjEGpKRAeKYakYYqMigpDCKjYVLUbUFIjIplPamGgtCU2nGkNIoZSYp1JQAlHaiigBKKKKBiUlLSCgBwHFJS000AQS8tipVGFFQ9ZKsDpVMlDraPfcoPeux/1Vl6cVzuiW/m3Ycjha29WmEVow6cV00laDZw4h801FHJXLbrmQ+ppopp5Yn3pVrmZ2pWVh1IetLihuFqSh8MXmNjoK0bW1t15Yb6wkvCsu08A1sWcvbsa9HDYeMleR5WNxM4PliaE1vbFQUhUfhWZf2UMkZxGAexArVjO6Mg9RVeZcqa7FSitLHmOtN63OMkQxyMp6g0zFXtZhMVwHA+VuDWfurnas7HRGV1c7AJDcLlSM1GYJoCSpJFYsFzJC2VJrZstUSUbZeK4NYnrShcs22oFTtfj61pRTRzL2zWfJbxTrlMexFVis1s3GStWpJ7mDg1qjZeHuvNQEEHmo7TUAcBquYSYZBGamVPsVGpbSRVeosVPNGyHpxUNZWN07kZGKjPSpnHFRNSLRGwqMipDTDQWhppKXtSGkUJTaWkoASiiigBKKKSgYUgpaQUALTWOFNOqOU4WhARRjL1YAycVDAOc1o6bb+fcqMcDk1aV3YhtRjdm7ott5FsGPU1na/c728sGtudxb230FcldymaZmPrXRVajHlRxUF7SbkytilWjFKK5TvHAUEcUCl7UIDKu0KSZFaenzbo1PcVWvY9yZqHTZdkhQmvSwlTWx5eOpXVzqbeTkH1p8gyao2z8CrwO5c13yR4q7GNrNt5ts+ByORXJEkHBPNd9cJuUj2rjdQtGju3Cjg81hUjfU6aEuht3OmMuSnIrPZGjOCCDXWY45qC50+OZc4ANeSpHuqXcxbTUJICASStbdvexXK44z6ViXWnyQEnBIqtG7xNlSQRTsnsNpM6OazB+ZDg1FFcS27YfOKrWeqHhZfzrSAjuEyMGhScTKVNPct293HMuGpZLYH5krHkheFt0ZOKtWmoEHa/H1rTSaMrSg9B8ilcg1Aa1P3VwvbNUri1ePpyKylBo3p1FIqGm08jrmmVmboaaSlNIaCkJTadTaQwpDS0lACUUUtAxppBSmkoAWq8x5xU5OBVb7z1URMmhGFrpdCtdkXmMOTWHZQmWZEA7811agW9rjpgVvRjq5HJip2XKjN1y5wuwHrXPmrWoTGW4Y54FVKyqS5pGtGHJAKKWkqDYWlpKKEA2RQyEGstswz5961zWffR4O7FbUpcrMasOaNjVs5Qyg1pwtxiue0ubKlT2ragbgV7cXzRufNVY8k2ieReKzp7YPISRWmeRULLzUtEp2JgBTs+lNU4FOXBrwT6MGQSLgjisy90sNlouDWrginKM01oCdjkJYXiYhgQamtbySA4zkV0F5ZxzKcgZrAurJ4CcDK1d77miaZr290k6cHmkltwwyODWFFI0TZU4rVtb8SAK/Wps1sJxJI55bZsHJFattepMoDYqhJtdfWqpRozlDitI1O5hKlfVGzPZLIN0fWs2WNoyQwxUtpqJQgPxWjmG6TnGaJQT1QQquGkjENNq9dWLxcqMrVIisWmtzrjJSV0NpO9LSVJYUlLSUDQlKKKKAENNFONNpgMlOFNRQjLZp0x7VNZQmV1UDqaqKJbsbeg2uf3rCres3PlwkCrdtGttagdMCud1e482YqDwK6Ze5CxwR/e1b9DPJySaSilrkPQQUlFFABRmkNNzQgJB0qK4TfGeKkRSR0qc24FsXdwG7CtFFrUxdWCdmzEtn8m49s10Fs+QDXP3SbJMitTTpt8Q9q9XCzurHkY6nZ8yNtDlaaRzTIWqWuho81CL0p6mmKaeK+ePpiVSCOacuBxmoc80qk5pisPIwDmq8saupDCpmORUTUAjGvLEqS0YrPwyHuCK6Vxkc1QurNZASowapSNEypbXhXhulXldXGRWRJE0ZwRToZ2jPtTaKsaToDzSwzvC3U4qKOZXHvTzyKFJoiUFLc2LW+SVcPg0t1YJKpeLGaxBlDlTir1pqDIcNWqamrM53GVN3iVpYniYq4xUdbzCG7TnGayrqzeBicZX1rGVNo6KVZT0e5VoopKzOgWkoooAM02nU0nAJpgV5Dl66Hw9Z5HmsOO1YdnA1xdKoHGea7SFFtbXHTArppQ6s5MRUsuVdSvqtyIoiAa5aRi7EnvV3VLkyzEA8CqFZ1Z8zKw9PljcBRRRWR0CUetApaBiVVnm2NxVk81TnhJyaqFr6kyvbQja/dTgdBVuC4M67iTmsl1IbmrUNwsWABnNdi2seZUi07li7TcucVHp0vlylCeDVpWUqA3eqM6GCYOvTNXTlySuTJ+0g4s6KB+KshuKy7ObegOa0Fb5a9J6o8VpxdiUHindqYp4pwIr50+nFpc8U3NKKQDsmkPSkoJ4pgRvTKeajYigpFeeFZAcisye3MZ46VrmonUMORTTsUjIVihyKuQ3AbhqZPbckqKqkFT6Gq0ZRp5BFNIqrDPjg1ZDBhxU7AT21y0TDk4rYguY7hMNisA0+KVo2yDWsZ9Gc1Sj1iaN7YFcvHyPSs48HBFa1peLIu1+abe2QdTJF1pTp9UVSrfZkZVFKwKkgjBFJWB1iVHKcLipKLSE3V2qY4B5q4q7sTJ2V2bPh2x2p5zjk1a1e6EcZUGrihba1AAAwK5nUrjzpiM8Cuqb5I2R58E6tS7KjMWJJ702kpa5D0QFFFFIAooopDCmMMinUlAGfNFgk4qNF2nJHSr8yZHFN8keXjFbqpoYypqRV+1biB0Iq0ds0WD1xWfPCY2yKltpiODW6d9TgnTcSxaS+QxRzwOlaaXY28cis2WETJuX7wohkKxgHgitlXklY5nh4Td2dADT1PpUC5HSnhj6V5p61iegGo1b1p4OKBCk0meKQmk7UAIajNOJppPFBSGNTDTzTDQUiNhVeWEMOnNWDTaBoznjKHmhJChq66hhzVWWEjpVJ3GTRyBx706qQJU8VYjlDDBoaAsRuUOQa1bK8BG1qxs0+NypyKuE7aMwq0uZXW5r31osimSPrWUQQSCK1bK5DLtao9QtMfvEHHeicOqJoVbe7IzJDhTW34etNsZlccmseKIzTpGB35rrIUFvagDjAq6MftMMVOy5UU9YufLiIB5rmSSSSau6rcGWcgHgVQFZ1JXZdCHLEWlFIKWszoCiiikMKKKSgA7UlDZAzVyzt0kt2kY9KcYtmc5qCuymykDODilSNpASoyBUskm6LZgcVFHctCpQDrWips53iVbRFeaLeprOdDE+a1z7jFVrmEMpIqotxdmXpVjcZbTVMYwxJHes0ExPg9KuJN8vBrc4ZRszoBTweKiBpymuI9Al60U0UtAhd1JmikzQAhNNNBppNBSENNJpSabQUNNMIp9NNIY2mkZFOptMZXkh4yKgwVNXqikiDcimpAMjkyMGpQaqEFTU0b54NNoRcgkKMK2reQSxbWrn1OK0LCbBxmtqUr+6zlr0/tI0NPsdl2zkcdqt6pcCK3P0p1vJ8uaxtbuN77AaqT5Y2MIXqTVzKdizknuaBQKUVynpJAKKKKQwoopKACilpKQwk+4RVOO8eEmMkhSauEcVJp9tbzO7TAcetbUnqc+IS5SNlYwiQA7fWqxbFW55ysDQqAFzx9KoEk8VujzWyRpi2M9qeh3iqucGlDkdDRKKZdOo4PQJrcOeDUBtnU4ByKsB6cGppWCVRydzZBpymmClFcZ6JKDTgajBpc0CsPzTc03NGaB2F5ptGeKbQMKbS02gYhpKDSUhgaZTqbQUJR2paSgRFJGGFV+VNXKhmTjIq0wFibcMGrunwtI5YdBWXDkuAOp4rqbG2MNpnHJFbU463OevO0bEls+PlNZOqQlJyx6Gr0Ug80j0NP1CIS22R1FXVjdHNRlyzMEUtGMGiuM9JBRRRQMKKKKAEooopAL2IqhJK8EhwTg1eqKaJXU5FaQlysznHmVhY1M0G9cnFV2GKWO7eCMxqvFQNcjuK6UzzZ02gNJT7ZftcnlxDLelEsTRStGwwynBqjIbT1HFMNPUjFAGyDSg0wU4VxHqjwadmowaXNADwaQmm5ooGKTSUlFABTe9KabQMSkzRRSGFNpaSmUIaKKWkAlMIzTjSYPQdTTQixpFl595ux8q11E4WK3I6YFVdFtfItwSOTVXxDeiCAqDya7F7sTzaj556Gck4+2sR0JrZjxJEV9RXK28mfm710VhJlBzU03e6ZdeHLaSMm6j8udl96hrR1eLDhwOtZtc0lZ2O2nLmimLRSUVJYtJRRQMKSiikAUUUUwI2jVu1V5bZCpq4KhnbZg4q4t30IklYXRT/Z1wZ3TcMYxUN7KZZ5Z2GC7FiPTNPW7SXCEbQKZPGCp5yDXSmeXJO5EjblzSdKiifyX+cfLU0ksTNlOBTFKDRsA04UwdKUGuM9Mfmim5pQaAHUU3NGaAHUlIDRQMKbS02gAoopM0hhTaWkNA0FFFJQMKt6Xbm4uQSOFqnycAdTXTaRa+TACRya2pRu7mFefLEusRDDjoAK4zXpjPcHngV0mr3XlwkA81y0w3gk9auc9bGGHp31ZVtXwcGt/TJOMVzgykla+nS/OKE7Sua1FeDRsajH5lsT6Vh10f+styPauemXZKy+hqay1uThZXTQyiiisDrCkoooGFFFFACUtJRQAU11DDBp1FCEUZbbnipYkITBJNWCKTFac7asRyK9ytNbh1OKpGNlJAzWtioXiUseKqFRomdNSLopwNMzSishj6UU0GlBoAWlptGaAFozSZooGLSUUlABSdqKSgYUUUmaQwJ4pKSjBZgo6mqSC5c0u2NxcbiPlFdOSIYfoKpaTbCCAEjk03VrkRwkA811JckTzqknUnZGNqdwZpyM8CqVKSWYk96BXK3d3O+EeVWKVym1s1PYSYYe1LcJuWqkLFJK1i7omR2Nm25B9KytTj2XBPrVzTJNyCm6xH8ofFXUV43OSi+WpYyaKKK5T0AooooASlpKKACiiigYUUUUCCkpaSgAFRsealFQyfeNUhFnNLTaWkQOopKM0AOzRTaWgYuaM02gGgB2aTNGaTNAC0lFFAwpDQTim0AL2NXdItjPcbyOBVAAu4RepNdTplsILccc1tSjd3MK8+WNi2xEcXpgVzGqXHmzFQeBWxqlyI4iO9c0xLMSadWXQyw0PtMBSikFLWB2iMMqaz5QUkNaNVLtO9XTetiZLQ1dHmyAM1q3yeZan6Vzmky7ZttdOuHgI9q6LXjY4KnuzTOcPBpKknXZMw96jrkPRTugooopDCiikoAWikpaACiiigBKKKKYBTGGTT6BQgHUopopRQZi0tNpRQAtLTaWgYtFJQKACilpKACiimmgAJpCcCimkZYA9M00guaOjWplm8xhwOldCzCOP0AFVNMRUtxtGOKNRcrE2DXUlyxPOnJznqY2p3BlmIB4FUhSuSWJPrQK5W7s9CEeVWAUUCikWhainXchqSkYcGhaMGUbZzHcL9a6+xcPGPcVxz8S8etdPpLExLXZE4K6K2qR7LjPrVGtbWVG1T3rJrlmrM6qLvBBRRRUmwU3NKelNoQhc0uabRTAdmjNN7UUAOBpRimUtIB1JmkzS0Af/Z"
          imgUrl: imageURI
        });
      }, function(err) {
        console.error(error);
      });
    });
  };

  $scope.postForm = function() {

    var form = {
      question: $scope.form.question,
      images: $scope.images.map(function(img) {
        return 'data:image/jpeg;base64,' + img.imgUrl;
      })
    };
    PickaloApiService.postForm(form).then(function(response) {
      alert(response);
    });
  };
});
